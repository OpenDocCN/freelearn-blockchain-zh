- en: Designing the Solution Architecture
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this chapter, we''ll review the architecture of our IoT- and blockchain-based
    solution for the food logistics network, exploring the following topics:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
- en: '**The business side**: We''ll review the business components and the main actors
    on the business side of things, as well as the processes that take place between
    production and the consumer.'
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**The technology**: We''ll present a diagram of the technological solutions
    that we''ll be engineering.'
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Software**: We''ll present a diagram detailing the solution at the software
    level, examining layers and integration.'
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We'll also review some concepts and architecture involved in our IoT- and blockchain-based
    solution in more detail.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
- en: The business of food
  id: totrans-6
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The modern food chain is very large and complex. There are numerous actors involved
    that influence the making of the product and its delivery, whether directly or
    indirectly.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
- en: 'We''ll be looking at this modern food production process, learning about the
    challenges of the modern chain and proposing a new one based on blockchain and
    IoT:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/b6ef5203-faa7-4e12-bf09-9434e292eb37.png)'
  id: totrans-9
  prefs: []
  type: TYPE_IMG
- en: The business process shown in the preceding diagram is a simplified version
    of the modern food chain. The chain can be much bigger than the one represented
    here. For example, many supermarkets have their own distribution centers. However,
    since our main goal is simplification, we didn't represent other factors, such
    as ports and customs.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
- en: For our use case, we'll seek to account for the product from the time it's delivered
    to the manufacturer. This product could be any item, but we'll use chicken drumsticks
    for our example.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
- en: 'The asset to be managed in our chain will be a box full of chicken drumsticks,
    and our other asset will be a pallet full of boxes containing chicken drumsticks.
    In the food chain, we''ll be looking at the processes of the following actors:
    the manufacturer, distribution center, and retailers.'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
- en: As stated previously, there are a lot of actors in the modern food chain. Remember
    that we're following a more simplified process, not necessarily the actual process
    followed in real life. Our goal Here's understanding how IoT and blockchain can
    help the parties and processes inside the food chain.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
- en: Challenges of the process
  id: totrans-14
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The part of the food chain we have chosen to focus on has many challenges.
    We''re listing them briefly here:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
- en: '**Challenges from the farmer''s perspective**: Securing documentation of key
    information on raw materials, such as product descriptions, dates of inspections,
    date of abatement, and stock information'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Challenges from the manufacturer''s perspective**: Ensuring product origin
    and safe delivery and receipt of products, packaging products with electronics,
    using barcode/QR code informational labeling for regulators and consumers, and
    aggregating products into packages'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Challenges from the retailer''s perspective**: Checking package integrity
    and maintaining visibility of product packages across the transport lines with
    dates, warehouse validation, and quality control'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Challenges from the consumer''s perspective**: Having confidence in the origin
    of the product and the information contained in its packaging, as well as identifying
    goods quickly and, if necessary, removing suspect products from the shelves and
    consumption'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The process at the food factory
  id: totrans-20
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Let's start from the beginning of our target process. In our use case, the product
    arrives at the factory in large pieces, where it'll be cut, packed, and put in
    boxes for sale. This product is stored and the boxes are put onto pallets before
    delivery.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
- en: 'A pallet is a wooden, metallic, or plastic platform used for moving goods,
    as we can see in the following diagram:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/9159aa57-6758-47a5-b3c6-afb9d0eca173.png)'
  id: totrans-23
  prefs: []
  type: TYPE_IMG
- en: 'Next, we''ll see the important data that must be registered about the product
    before it proceeds to the next stage. When the product arrives, the following
    data is captured and recorded:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
- en: '**Stock Keeping Unit** (**SKU**)'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Animal origin
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Name of producer
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Animal information
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Quality control
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Date of abatement
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Freezing
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Technical supervisor details
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Shipment date
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Temperature and transport details
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The following details are captured during the registration of a box or pallet:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
- en: SKU
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Date
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Factory address
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Freezing temperature
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Quality record
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Pallet code
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Now let's check the process for the next actor in the chain.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
- en: The process at the distribution center
  id: totrans-43
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'After being cut, packed, and delivered, the product arrives at the distribution
    center, where it''s received and checked for storage. Depending on the process,
    it might go to a bigger pallet that suits it better for transportation, which
    could be by train or truck:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/d2ebc4d1-c38a-4149-9875-e0bc670bd3ca.png)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
- en: 'To avoid any issues with the product, the distribution center reviews the data
    sent by the factory. If there''s any additional movement, such as pallet transfer,
    new information needs to be added to the package:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
- en: 'For the product, it''s the following:'
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Received date
  id: totrans-48
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Pallet number
  id: totrans-49
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Temperature received at
  id: totrans-50
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Temperature for storage
  id: totrans-51
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Transport company
  id: totrans-52
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Quality seal
  id: totrans-53
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: For the pallet, it's the following**:**
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Destination code
  id: totrans-55
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Pallet code
  id: totrans-56
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Date
  id: totrans-57
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Temperature for dispatch
  id: totrans-58
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Transport company
  id: totrans-59
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: After inspection, the products are sent to the retailers.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
- en: The process at supermarkets and stores
  id: totrans-61
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The store will receive the product and check the goods to see whether they
    fit the requirements. If they do, the pallets are disassembled and the boxes are
    opened. This concludes the monitoring of our assets:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/77ca5156-5ff6-463d-84e9-1d486e7d9bac.png)'
  id: totrans-63
  prefs: []
  type: TYPE_IMG
- en: 'The following important data must be registered at this stage for the product
    to reach the consumer:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
- en: Received date
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Pallet number
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Temperature received at
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Temperature for storage
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Transport company
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Quality seal
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Now it's the store's responsibility to put a label on the product, after which,
    it may or may not be taken straight to the shelf.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
- en: The technological approach
  id: totrans-72
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Now that we have a better understanding of our process and potential problems,
    let''s see how technology can be useful to us. Here''s a representation of a standard
    blockchain Hyperledger Fabric architecture:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/6b953461-f3fd-45fa-a64b-fbf7a238022e.png)'
  id: totrans-74
  prefs: []
  type: TYPE_IMG
- en: 'The preceding diagram shows us three important layers: frontend applications
    (on the left), API/SDK (in the center), and Hyperledger Fabric and the IoT platforms
    (on the right).'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
- en: Let's review each layer in more detail.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
- en: Frontend applications
  id: totrans-77
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'This layer is responsible for data input and can be a packet, such as one from
    SAP, Salesforce, or Siebel, or a custom application. It can also interact with
    IoT devices, collecting data and registering in the blockchain ledger. The modern
    architecture for developing frontend applications consists of these layers:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/7af24390-1421-4556-ae81-32d546279b76.png)'
  id: totrans-79
  prefs: []
  type: TYPE_IMG
- en: Okay, I know there are a lot of other tools for each layer than those presented
    here, but I just used the ones I'm more familiar with.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
- en: This type of frontend architecture allows us to separate our services from a
    single interface. By doing so, we can expand the **User Experience** (**UX**) to
    several platforms without the need to rebuild the whole application.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
- en: IoT-based asset tracking
  id: totrans-82
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: IoT plays an important role in the food chain. IoT devices can track assets,
    and there's an arsenal of models available that can do that. There are sensors
    for measuring temperature, and location can be determined using GPS, beacons,
    SigFox, Wi-Fi, 4G, and Sub1Ghz. These devices and networks can be used by farms,
    factories, transportation companies, distribution centers, and retail outlets,
    covering all actors in the food chain.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
- en: The major challenge in the food chain is transportation. Many foods require
    special care, and temperature is one of the most important concerns. Since many
    foods are perishable, and temperature control is vital for preventing contamination
    and damage.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s take a look at how we can mitigate this challenge using an IoT-enabled
    device. The Particle Electron Asset Tracker (pictured in the following diagram)
    can be used to collect temperature and environmental data and identify GPS location
    and cellular triangulation, among other things:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/5ae745ea-7620-488f-ace3-90f52b6db786.png)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
- en: This tracker allows us to connect with a u-blox M8 GNSS GPS receiver and Adafruit
    LIS3DH Triple-Axis Accelerator. We can connect Grove sensors to it as well.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s look at a high-level architecture of this kind of IoT solution:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/1eb010e8-a5e7-4851-949b-ae1eba26fb37.png)'
  id: totrans-89
  prefs: []
  type: TYPE_IMG
- en: 'This diagram shows us some important components of the solution. Let''s see
    what they are:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
- en: '**Message Queuing Telemetry Transport** (**MQTT**): This refers to a publish-subscribe-based
    messaging protocol that works over TCP. It''s designed for connections with remote
    locations where a small code footprint is required or the network bandwidth is
    limited. The publish-subscribe messaging pattern requires a message broker.'
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**消息队列遥测传输（MQTT）**：这是一种基于发布-订阅的消息传输协议，通过TCP工作。它专为需要小代码占用空间或网络带宽有限的远程连接设计。发布-订阅消息传输模式需要一个消息代理。'
- en: '**Node-RED**: Node-RED is a programming tool for wiring together hardware devices,
    APIs, and online services in an easy way using a flow editor that can create JavaScript
    functions.'
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Node-RED**：Node-RED是一种用于在易于使用的流程编辑器中简单地连接硬件设备、API和在线服务的编程工具。'
- en: '**IBM Cloud**: This is a set of cloud computing services for business.'
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**IBM Cloud**：这是一套面向企业的云计算服务。'
- en: '**Bosch IoT Rollouts**: This is a cloud service in the Bosch IoT Suite that
    enables users to manage the rollout of software updates to edge devices, controllers,
    and gateways.'
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Bosch IoT Rollouts**: 这是Bosch IoT Suite中的一个云服务，可以让用户管理边缘设备、控制器和网关的软件更新的推出。'
- en: 'So, how do these components come together to assist in the various processes
    in the food chain? Here''s how:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 那么，这些组件如何组合在一起以帮助食品供应链中的各种流程？以下是：
- en: The Node-RED control panel dashboard enables us to select an asset tracker and
    check the location, data, device status, and other information
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Node-RED控制面板仪表板使我们能够选择资产跟踪器，并检查位置、数据、设备状态和其他信息
- en: The asset tracker device can be either activated or updated over a cellular
    network
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 资产跟踪设备可以通过蜂窝网络进行激活或更新
- en: Geolocation data can be transmitted periodically and can be followed by a dashboard
    in Node-RED, for example
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 地理位置数据可以定期传输，并且可以在Node-RED中的仪表板上进行跟踪
- en: The asset tracker device queries the temperature data and then may query for
    location or velocity data
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 资产跟踪设备查询温度数据，然后可能查询位置或速度数据
- en: Node-RED can write the temperature, location, and velocity data to Hyperledger
    Fabric
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Node-RED可以将温度、位置和速度数据写入Hyperledger Fabric
- en: The Node-RED dashboard queries Hyperledger Fabric for various tasks and information,
    such as transaction histories, date and time data, and geo-sensor data
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Node-RED仪表板查询Hyperledger Fabric以获取各种任务和信息，例如交易历史记录、日期和时间数据和地理传感器数据
- en: API/SDK
  id: totrans-102
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: API/SDK
- en: The SDK or API is an integration layer responsible for connection in the blockchain
    network. It's normally developed using Node.js and plays an important role in
    the calling of smart contracts. Today, we can find API/SDK documentation covering
    Go and Java, with documentation for Python on the horizon.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: SDK或API是一个负责在区块链网络中建立连接的集成层。通常使用Node.js开发，并在调用智能合约中起着重要作用。今天，我们可以找到覆盖Go和Java的API/SDK文档，并且Python的文档正在制定中。
- en: You can refer to this link for more information on how to use APIs/SDKs to integrate
    your application with a blockchain network: [https://hyperledger-fabric.readthedocs.io/en/release-1.3/fabric-sdks.html](https://hyperledger-fabric.readthedocs.io/en/release-1.3/fabric-sdks.html).
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以参考此链接以获取有关如何使用API/SDK将您的应用程序与区块链网络集成的更多信息：[https://hyperledger-fabric.readthedocs.io/en/release-1.3/fabric-sdks.html](https://hyperledger-fabric.readthedocs.io/en/release-1.3/fabric-sdks.html)。
- en: 'The following diagram shows an application integrated with an API/SDK that
    interacts with Hyperledger Fabric:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 以下图示显示了一个与通过API/SDK与Hyperledger Fabric交互的应用程序集成：
- en: '![](img/590b546a-02ee-460b-b83e-d139031123a0.png)'
  id: totrans-106
  prefs: []
  type: TYPE_IMG
  zh: '![](img/590b546a-02ee-460b-b83e-d139031123a0.png)'
- en: Composer JavaScript SDK is derived from Node.js, and it allows developers to
    integrate your application with their business networks.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: Composer JavaScript SDK源自Node.js，允许开发人员将您的应用程序与他们的业务网络集成。
- en: 'There are two npm modules:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 有两个npm模块：
- en: '`composer-client`: This module is usually installed as a local dependency of
    an application. It provides the API that''s used by business applications to connect
    to a business network in order to access assets and participants and submit transactions.
    When in production, this is the only module that needs to be added as a direct
    dependency of the application.'
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`composer-client`：这个模块通常作为应用程序的本地依赖项安装。它提供了业务应用程序用来连接业务网络以访问资产和参与者并提交交易的API。在生产中，这是需要作为应用程序的直接依赖项添加的唯一模块。'
- en: '`composer-admin`: This module is usually installed as a local dependency of
    administrative applications. This API permits the creation and deployment of business
    network definitions.'
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Now let's move on to the last layer in our solution.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
- en: Hyperledger Composer – a high-level overview
  id: totrans-112
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Hyperledger Composer is an easy way to create your blockchain network, integrated with
    a full-stack working solution, as provided by the Hyperledger Composer architecture
    site.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
- en: 'At a high level, Hyperledger Composer is made up of the following components:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
- en: Execution runtimes
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: JavaScript SDK
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Command Line Interface** (**CLI**)'
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: REST server
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: LoopBack connector
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Playground web user interface
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Yeoman code generator
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: VS Code and Atom editor plugins
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: It would be outside the scope of this book to review each of these in detail.
    You can visit this link to explore these components briefly: [https://hyperledger.github.io/composer/latest/introduction/solution-architecture](https://hyperledger.github.io/composer/latest/introduction/solution-architecture).
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
- en: Software components
  id: totrans-124
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Now we'll look at the software components of our solution for an architect's
    perspective. This is a good way to get familiarized with all of the components
    and have a better understanding of how they are integrated.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
- en: 'To start, let''s explore one of the most important components: the authentication
    process.'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
- en: 'How we can guarantee that each member of the blockchain has the correct access
    permission in our frontend application? After answering this question, we''ll
    delve into the most important components of Hyperledger Composer: the modeling
    language and the transaction processor functions.'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
- en: Composer REST server
  id: totrans-128
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: To authenticate clients, we'll need to set up a REST server. With this option
    available, the clients should be authenticated before they are permitted a call
    in the REST API.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
- en: The REST server uses an open source software named PASSPORT, an authentication
    middleware for Node.js. It's flexible and modular and supports authentication
    via username and password, Facebook, Twitter, Google, and **Lightweight Directory
    Access Protocol **(**LDAP**), among others. In [Chapter 7](d067a20b-616f-49da-9614-ae0631a7e4f8.xhtml),
    *Creating Your Blockchain and IoT Solution*, we'll have more details about this.
    For now, let's review how the components will work.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
- en: 'In the following diagram, we can see a high-level authentication architecture
    using a Composer REST server:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/3e2e08c9-dc65-4f1d-bcbc-fc815d3a98ab.png)'
  id: totrans-132
  prefs: []
  type: TYPE_IMG
- en: 'The following components have been described in the diagram: a frontend application,
    a composer REST server, LDAP, and Cloudant, a NoSQL database.'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
- en: If you're working on a test or need to create a proof of concept quickly, I
    strongly recommend using Facebook, Google, or Twitter for authentication. It'll
    be easier and faster than other methods.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
- en: 'To use the previous approach to use the composer REST server as custom implementation,
    we need to do some customization. Perform the following steps:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
- en: 'There''s a following line the `composer-rest-server` installation that needs
    to be executed before the line:'
  id: totrans-136
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Make sure you have a clean environment before using this approach by cleaning
    all previous installations.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
- en: 'To customize our composer REST server Dockerfile, add the following command in
    the RUN statements:'
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Create the following environment variables:'
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-142
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'If you''re checking the API call and receive `404`, it means you''re not logged
    on:'
  id: totrans-143
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Check whether we have an API in our Wallet:'
  id: totrans-145
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'To understand the process authentication better, let''s explore this execution
    flow:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/38e6605e-aa2b-46cd-8116-95d0f833490f.png)'
  id: totrans-148
  prefs: []
  type: TYPE_IMG
- en: Each API call of `composer-rest-server` must include `access_token`, which is
    brought back by the authentication. For more information, see [https://hyperledger.github.io/composer/v0.16/integrating/enabling-rest-authentication](https://hyperledger.github.io/composer/v0.16/integrating/enabling-rest-authentication).
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
- en: 'Some examples using `curl` are:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Here''s another example:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-153
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'This is the final step in setting up your `composer-rest-server`: creating
    a business card with Cloudant.'
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Create member cards with the following attributes:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
- en: '**ID**: `wallet-data/admin@system name`'
  id: totrans-156
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Key**: `wallet-data/admin@system name`'
  id: totrans-157
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Value**: `{"rev" : "5-1af3gs53gwh...."}`'
  id: totrans-158
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Upload the attachment as shown in the following screenshot:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/9e5250b5-5054-4fb1-b0c7-d59820f2f9ec.png)'
  id: totrans-160
  prefs: []
  type: TYPE_IMG
- en: In [Chapter 7](d067a20b-616f-49da-9614-ae0631a7e4f8.xhtml), *Creating Your Blockchain
    and IoT Solution*, we'll deploy this implementation.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
- en: Hyperledger Composer model
  id: totrans-162
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'There are many ways to identify a blockchain use case. Let''s remember some
    important indicators of a good use case described in [Chapter 3](fe11e1f3-8540-4126-ace5-2c877b06d6bf.xhtml),
    *Explaining Blockchain Technology and Working with Hyperledger*:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
- en: Is there a business network involved?
  id: totrans-164
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If yes, is there a transaction that needs validation and is auditable?
  id: totrans-165
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Are transparency and data immutability important?
  id: totrans-166
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: After determining the answers to these questions, brainstorm sessions are also
    a good way to detail the solution and identify the best solution platform (such
    as IBM Food Safety), or to start creating a custom development for the use case.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
- en: Using Hyperledger Composer Modeling Language can be an easy way to define the
    structure of the resource that'll be processed as a transaction and stored on
    the ledger.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
- en: 'The CTO file creates the domain model for a business network definition with
    three major elements:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
- en: A single namespace that contains all resource declarations within the file
  id: totrans-170
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A set of resource definitions encompassing assets, transactions, participants,
    and events
  id: totrans-171
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Optional import declarations that import resources from other namespaces
  id: totrans-172
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'In [Chapter 7](d067a20b-616f-49da-9614-ae0631a7e4f8.xhtml), *Creating Your
    Blockchain and IoT Solution*, we created a business network. Let''s explore the
    code we used in more detail:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
- en: 'A namespace is the base definition of an asset, event, participant, and transaction,
    as you can see here:'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-175
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'The declaration of resources and enumerated types is shown in the following
    code:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-177
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Transaction process functions are automatically invoked by the runtime when
    transactions are submitted using the Business Network Connection API:'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-179
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'For more information about Hyperledger Composer Modeling Language, you can
    visit the following links:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
- en: '[https://hyperledger.github.io/composer/v0.16/reference/cto_language.html](https://hyperledger.github.io/composer/v0.16/reference/cto_language.html)'
  id: totrans-181
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[https://hyperledger.github.io/composer/v0.16/reference/js_scripts.html](https://hyperledger.github.io/composer/v0.16/reference/js_scripts.html)'
  id: totrans-182
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The Hyperledger Composer access control language
  id: totrans-183
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Hyperledger Composer has an access control file (`.acl`) with which you can
    program business access control and network access control. Business access control
    is for resources within a business network, whereas network access control refers
    to control over administrative network changes.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
- en: 'Here''s an example of network access control being granted:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-186
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Here''s another example:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  id: totrans-188
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: You can get further information about the Hyperledger Composer access control
    language by accessing the following link: [https://hyperledger.github.io/composer/v0.16/reference/acl_language.html](https://hyperledger.github.io/composer/v0.16/reference/acl_language.html).
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
- en: Hyperledger Composer transaction processor functions
  id: totrans-190
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: A Hyperledger Composer business network definition is composed of a set of model
    files and a set of scripts. The scripts may contain transaction processor functions
    that implement the transactions defined in the business network definition's model
    files.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
- en: 'Here''s an example of a script file with a transaction:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  id: totrans-193
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: As we can see, transaction processor functions are automatically invoked by
    the runtime when transactions are submitted using the `BusinessNetworkConnection`
    API. Decorators within documentation comments are used to annotate the functions
    with the metadata required for runtime processing, and each transaction type has
    an associated registry for storing the transactions.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  id: totrans-195
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The architecture described in this chapter involves many components, and the
    implementation may seem a little complex. By now, we've established that the combination
    of IoT and blockchain can mitigate several issues and transform the workings of
    the modern food chain. For example, such an implementation can bring transparency
    between members, allowing them to control data more efficiently; increase their
    security; make the process automatic and dynamic; remove middlemen; and make the
    chain less complex overall.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
- en: We also saw that IoT works as the extension of computing and network capabilities
    for devices and sensors, enabling them to make machine-to-machine interactions
    with minimal or no human input. These technological components bring advantages
    such as unprecedented automation, cost reduction for provisioning, energy savings,
    value-added services, and efficient management.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
- en: Blockchain's integration with IoT will make possible data exchange between edge
    devices such as sensors, barcode and QR code scan events, and RFID-based assets.
    Assets connected with sensors will be able to record sensitive information, such
    as the location and temperature of a particular warehouse, and this information
    could be automatically logged or updated on a blockchain.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 区块链与物联网的整合会使传感器、条形码和二维码扫描事件以及基于射频识别（RFID）的资产等边缘设备之间的数据交换成为可能。连接传感器的资产将能够记录敏感信息，例如特定仓库的位置和温度，并且这些信息可以自动记录或更新在区块链上。
- en: With a better understanding of the architecture and the elements that comprise
    its technical components, we'll be able to fully implement a solution with IoT
    and blockchain for the modern food chain.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 通过更好地理解架构以及构成其技术组件的要素，我们将能够充分实施用于现代食品链的物联网和区块链解决方案。
- en: In the next chapter, we'll see how to create our own blockchain with IoT.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将看到如何使用物联网创建自己的区块链。
- en: Questions
  id: totrans-201
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: Q. How can a lack of IoT security compromise data in a blockchain network?
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: Q. 物联网安全不足如何威胁区块链网络中的数据？
- en: A. Sometimes, companies don't focus on security when they work with IoT. Perhaps
    because it's a new technology, they don't believe it comes with imminent risk.
    The fact is, however, that businesses are bringing insecure devices into their
    networks and then failing to update the software. Not applying security patches
    isn't a new phenomenon, but insecure IoT devices with a connection to the internet
    is a disaster waiting to happen; think hackers and DDoS attacks. A strong security
    plan should be developed for IoT devices, similar to the one for internet services.
    Strong device identification and updates can help mitigate most problems.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: A. 有时，公司在使用物联网时并不关注安全性。也许因为这是一项新技术，他们并不认为会带来立即的风险。事实是，企业正在将不安全的设备引入其网络，然后未能及时更新软件。不应用安全补丁并非新现象，但是带有互联网连接的不安全物联网设备是一场灾难等待发生；想想黑客和分布式拒绝服务（DDoS）攻击。应为物联网设备制定强有力的安全计划，类似于互联网服务的安全计划。强大的设备识别和更新可以帮助减轻大多数问题。
- en: Q.Is blockchain technology mature enough for this application?
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: Q. 区块链技术对于这种应用已经足够成熟了吗？
- en: A. Today, there're a number of blockchain platform providers available on the
    market. Carrefour, Walmart, and others are already members of these platforms.
    So, this indicates that big companies are already running their businesses on
    a blockchain platform, and that such a platform is suited to this kind of application.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: A. 如今，市面上有许多区块链平台供应商。家乐福、沃尔玛等已经是这些平台的成员。因此，这表明大公司已经在区块链平台上经营业务，而这样的平台适用于这类应用。
- en: Q. How complex is it to implement a solution using IoT and blockchain?
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: Q. 使用物联网和区块链实施解决方案有多复杂？
- en: A. Most of the technologies described in this chapter are open source and are
    used by a huge number of companies. This shows that we're not talking about something
    that's that complicated, but something that can be used by most developers.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: A. 本章描述的大多数技术都是开源的并被许多公司使用。这表明我们讨论的不是什么复杂的东西，而是大多数开发人员可以使用的东西。
- en: Q. How complex is it to have a solution that covers the entire food chain?
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: Q. 有多复杂的方案能够覆盖整个食物链？
- en: A. Yes, it's not an easy task. You can start by validating the use case; a good
    use case is essential. Also, check whether there's a business network involved;
    remember, IoT also plays an important role in tracking the assets, and you should
    have a security plan for asset tracking as well.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: A. 是的，这并不是一项容易的任务。您可以通过验证用例来开始；一个好的用例是至关重要的。此外，检查是否涉及业务网络；记住，物联网也在追踪资产方面发挥着重要作用，并且您应该为资产追踪制定安全计划。
- en: Q. Should I be concerned about using an open source tool such as Hyperledger
    Fabric or Composer?
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: Q. 使用 Hyperledger Fabric 或 Composer 等开源工具是否需要担心？
- en: A. Hyperledger is part of the Linux Foundation, which has more than 250 companies
    as members, including leaders in finance, banking, supply chain, manufacturing, and
    technology. For example, IBM, Cisco, American Express, Fujitsu, Intel, and JP
    Morgan all use technology by the Linux Foundation. In other words, these tools
    are safe to use provided you employ standard security measures on your devices.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: A. 超级账本是 Linux 基金会的一部分，拥有250多家公司作为成员，包括金融、银行、供应链、制造和技术领域的领导者。例如，IBM、思科、美国运通、富士通、英特尔和摩根大通都在使用
    Linux 基金会的技术。换句话说，只要在设备上采用标准的安全措施，这些工具就是安全的。
- en: Further reading
  id: totrans-212
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: A better description of Hyperledger Composer can be found on the Composer website:[ https://hyperledger.github.io/composer/v0.19/introduction/solution-architecture](https://hyperledger.github.io/composer/v0.19/introduction/solution-architecture).
  id: totrans-213
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The main focus in this chapter was Hyperledger Composer. If you want to explore
    the architecture of Hyperledger Fabric, you can find further information here: [https://hyperledger-fabric.readthedocs.io/en/release-1.3/arch-deep-dive.html](https://hyperledger-fabric.readthedocs.io/en/release-1.3/arch-deep-dive.html).
  id: totrans-214
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Yeoman is an open source framework that creates your frontend structure. For
    further information, visit [https://yeoman.io/](https://yeoman.io/).
  id: totrans-215
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Passport is an authentication middleware for Node.js. For further information,
    go to [http://www.passportjs.org/](http://www.passportjs.org/).
  id: totrans-216
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: You can have further information about the Hyperledger Composer access control
    language by accessing the following link: [https://hyperledger.github.io/composer/v0.16/reference/acl_language.html](https://hyperledger.github.io/composer/v0.16/reference/acl_language.html).
  id: totrans-217
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'You can have further information about Hyperledger Composer Modeling Language
    by accessing the following links:'
  id: totrans-218
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[https://hyperledger.github.io/composer/v0.16/reference/cto_language.html](https://hyperledger.github.io/composer/v0.16/reference/cto_language.html)'
  id: totrans-219
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '[https://hyperledger.github.io/composer/v0.16/reference/js_scripts.html](https://hyperledger.github.io/composer/v0.16/reference/js_scripts.html)'
  id: totrans-220
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Information about composer-rest-server can be found at [https://hyperledger.github.io/composer/v0.16/integrating/enabling-rest-authentication](https://hyperledger.github.io/composer/v0.16/integrating/enabling-rest-authentication).
  id: totrans-221
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
